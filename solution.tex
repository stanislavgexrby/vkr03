% !TeX spellcheck = ru_RU
% !TEX root = vkr.tex

\section{Первый запуск}

При первой попытке запустить библиотеку MyGEMM~\cite{mygemm_repo}, следуя инструкциям из официального репозитория, возникла ошибка на этапе выполнения OpenCL ядер. Сообщение об ошибке указывало на проблему с созданием рабочих групп (work-groups), однако точная причина не была очевидна из текста ошибки.

Для выяснения причины был проведён анализ исходного кода библиотеки. Изучение реализации различных ядер показало, что ключевыми параметрами, определяющими размер рабочих групп, являются константы TS (Tile Size), TSM (Tile Size M) и TSN (Tile Size N). Согласно документации MyGEMM~\cite{nugteren2018mygemm}, эти параметры определяют размерность блоков данных, обрабатываемых одной рабочей группой. Например, для ядер 1--3 размер рабочей группы составляет $\text{TS} \times \text{TS}$ потоков, а для ядер 4--10 размер определяется как $\frac{\text{TSM}}{\text{WPTM}} \times \frac{\text{TSN}}{\text{WPTN}}$ потоков.

Значения по умолчанию в библиотеке установлены для дискретных GPU NVIDIA и составляют TS = 32, TSM = 128, TSN = 128, что приводит к созданию рабочих групп размером от 1024 до 4096 потоков в зависимости от конфигурации других параметров.

Для определения аппаратных ограничений платформ была использована утилита \texttt{clinfo}~\cite{clinfo}, предоставляющая детальную информацию о возможностях OpenCL устройств. Анализ вывода утилиты на обеих платформах показал, что максимальный размер рабочей группы (параметр \texttt{CL\_DEVICE\_MAX\_WORK\_GROUP\_SIZE}) составляет всего 32 потока. Это ограничение является критическим для RISC-V платформ и существенно отличается от типичных значений для дискретных GPU (256--1024 потока).

С учётом выявленного ограничения были модифицированы параметры запуска для всех ядер библиотеки. Для ядер 1--3 параметр TS был установлен в значения 8, 16 и 32. Для ядер 4--10 были подобраны комбинации параметров TSM и TSN из множества \{32, 64, 128\} с соответствующими значениями WPTM и WPTN, обеспечивающие соблюдение ограничения на размер рабочей группы. После внесения изменений библиотека успешно скомпилировалась и запустилась на обеих платформах, что позволило перейти к экспериментальному исследованию производительности различных ядер.





\subsubsection{Взаимосвязь параметров и аппаратные ограничения}

При выборе параметров необходимо учитывать следующие ограничения:

\begin{itemize}
    \item \textbf{Максимальный размер рабочей группы}: на RISC-V платформах обычно составляет 32--256 потоков, что значительно меньше, чем на дискретных GPU (256--1024);
    \item \textbf{Объём локальной памяти}: ограничен на уровне рабочей группы (обычно 16--64 КБ), что накладывает верхнюю границу на произведение $\text{TSM} \times \text{TSN}$;
    \item \textbf{Количество регистров}: ограниченный регистровый файл может привести к register spilling при больших значениях WPTM, WPTN или RX, RY;
    \item \textbf{Выравнивание памяти}: для эффективной работы векторных операций необходимо, чтобы размеры матриц были кратны VW;
    \item \textbf{Кратность параметров}: для корректной работы требуется $\text{TSM} \bmod \text{WPTM} = 0$, $\text{TSN} \bmod \text{WPTN} = 0$, а для векторизованных версий также кратность VW.
\end{itemize}

Оптимальные значения параметров сильно зависят от архитектурных особенностей конкретного процессора и размеров перемножаемых матриц.
